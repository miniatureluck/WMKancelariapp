@using WMKancelariapp.Models.ViewModels
@using WMKancelariapp.Extensions
@model List<WMKancelariapp.Models.ViewModels.DeadlineDtoViewModel>

@{
    var parentViewIsDeadlineIndex = this.Context.GetRouteData().Values["controller"].ToString() == "Deadlines";
}
<table class="table table-striped table-hover table-sm align-middle" id="resultsTable">
    @if (!Model.Any())
    {
        @("brak")
    }
    else
    {
        <thead class="table-primary">
            <tr>
                <th scope="col">
                    <div class="filter-section">
                        <input type="text" id="descriptionInput" onkeyup="filterNames('descriptionInput', 'resultsTable', 0)" placeholder="Filtruj po opisie" class="filter-text-input" /><br />
                    </div>
                    @Html.DisplayNameFor(model => model.FirstOrDefault().Description)
                </th>
                <th scope="col">
                    <div class="filter-section">
                        <input type="text" id="caseNameInput" onkeyup="filterNames('caseNameInput', 'resultsTable', 1)" placeholder="Filtruj po sprawie" class="filter-text-input" /><br />
                    </div>
                    @Html.DisplayNameFor(model=>model.FirstOrDefault().Case)
                </th>
                <th scope="col" class="text-center">
                    @Html.DisplayNameFor(model => model.FirstOrDefault().Date)
                </th>
                <th scope="col" class="text-center">
                    @Html.DisplayNameFor(model => model.FirstOrDefault().IsCompleted)
                </th>
                @if (parentViewIsDeadlineIndex)
                {
                    <th>Akcje</th>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        <div class="text-truncate" style="max-width: 40vw">
                            <a asp-action="Details" asp-controller="Deadlines" asp-route-id="@item.DeadlineId">
                                @Html.DisplayFor(modelItem => item.Description)
                            </a>
                        </div>
                    </td>
                    <td>
                        <div class="text-truncate" style="max-width: 40vw">
                            <a asp-action="Details" asp-controller="Cases" asp-route-id="@item.Case.Id">@Html.DisplayFor(modelItem=> item.Case.Name)</a>
                        </div>
                    </td>
                    <td class="text-center">
                        @{
                            var date = item.Date.Date;
                            var isForToday = date == DateTime.Today;
                            var isForTomorrow = date == DateTime.Today.AddDays(1);
                            var isPastDeadline = date < DateTime.Today;
                            var isTimeDefault = date.TimeOfDay.Ticks == 0;

                            <div class="@( isForToday || isForTomorrow || isPastDeadline ? "text-danger" : "")@(isPastDeadline ? " fw-bold" : "")">
                                @(isTimeDefault ? date.ToShortDateString() : date.Date)
                            </div>
                        }
                    </td>
                    <td class="text-center">
                        @Html.DisplayFor(modelItem => item.IsCompleted)
                    </td>
                    @if (parentViewIsDeadlineIndex)
                    {
                        <td>
                            @await Html.PartialAsync("_ActionButtons", $"{item.DeadlineId}|Edit|Details|Delete|deleteText=terminu z opisem<br/><b>{item.Description}</b><br/>w sprawie<br/><b>{item.Case.Name}</b><br/>z datą do<br/><b>{item.Date}</b>")
                        </td>
                    }
                </tr>
            }
        </tbody>
    }
</table>
